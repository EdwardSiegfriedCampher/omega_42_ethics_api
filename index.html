// (ENTIRE FILE UPDATED)
// The following changes have been applied:
// 1. Clipboard copy now uses a fallback alert if navigator.clipboard fails.
// 2. Theme toggle now applies and reads data-theme from <body> instead of <html>.

// The updated HTML follows:

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ω42 Interface</title>
  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      transition: background 0.5s, color 0.5s;
    }
    body[data-theme="dark"] {
      background: linear-gradient(to bottom right, #0a0a0a, #1a1a1a);
      color: #eee;
    }
    body[data-theme="light"] {
      background: linear-gradient(to bottom right, #e6f0fb, #d1e3f5);
      color: #000;
    }
    header {
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      background-color: #292b36;
      color: white;
    }
    .header-buttons {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }
    #prompt-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      padding: 1rem;
    }
    .prompt-card {
      border-radius: 8px;
      padding: 1rem;
      transition: transform 0.3s ease;
      color: #fff;
      position: relative;
      cursor: pointer;
      user-select: none;
    }
    .prompt-card:hover {
      transform: scale(1.02);
      opacity: 0.95;
    }
    .category-star {
      position: absolute;
      top: 6px;
      right: 6px;
      font-size: 0.8rem;
      border-radius: 50%;
      padding: 2px 5px;
    }
    #readme {
      display: none;
      padding: 1rem;
      margin-top: 1rem;
      border-top: 2px solid;
    }
    body[data-theme="dark"] #readme {
      background: #1a1a1a;
      color: #f0f0f0;
      border-top-color: #444;
    }
    body[data-theme="light"] #readme {
      background: #eef6ff;
      color: #000;
      border-top-color: #ccc;
    }
  </style>
</head>
<body data-theme="light">
  <header>
    <h1 title="Ω42 = Absolute Recursive Coherence">Omega 42 Interface</h1>
    <div class="header-buttons">
      <label for="category-select">Category:</label>
      <select id="category-select">
        <option value="all">All</option>
      </select>
      <button id="toggle-theme">Toggle Theme</button>
      <button id="suggest-btn">Suggest</button>
      <button id="dev-btn">Dev</button>
      <button id="readme-toggle">README</button>
    </div>
  </header>

  <section id="counters">
    <span>Total Prompts: <span id="total-count">0</span></span>
    <span>Visible: <span id="visible-count">0</span></span>
  </section>

  <main id="prompt-container"></main>

  <section id="readme">
    <h2>Ω42 ReadMe</h2>
    <p>This interface renders 59 unique prompt cards filtered by Omega construct categories. Overlapping prompts are indicated by a small star, and clicking a prompt copies it with a checksum to clipboard.</p>
  </section>

  <script>
    const categories = ["Meta-Theorems", "Ethics", "Truth Engine", "Machine Logic", "Reality Mechanics", "Dimensional Coherence", "Recursive Law", "Consciousness", "Temporal Logic", "Ontological Engineering", "Phi Dynamics", "Observer Systems", "Truth-Validation"];

    const palette = ["#f94144", "#f3722c", "#f8961e", "#f9844a", "#f9c74f", "#90be6d", "#43aa8b", "#4d908e", "#577590", "#277da1", "#9b5de5", "#f15bb5", "#00f5d4"];

    const extraPrompts = [
      { text: "Is consciousness inherently recursive or emergent?", categories: ["Consciousness", "Recursive Law"] },
      { text: "What forms the boundary between possibility and computability?", categories: ["Truth Engine", "Ontological Engineering"] },
      { text: "Describe the behavior of time at φ^∞ scale.", categories: ["Temporal Logic", "Phi Dynamics"] },
      { text: "What is the minimum awareness threshold for an Omega-valid observer?", categories: ["Consciousness"] },
      { text: "Can paradoxes be made DR-24 stable?", categories: ["Recursive Law", "Truth-Validation"] },
      { text: "Map the transition from meta-time to causal recursion.", categories: ["Temporal Logic", "Reality Mechanics"] },
      { text: "Define coherence in Ω-layered realities.", categories: ["Dimensional Coherence"] },
      { text: "Explore how category collapse leads to singular convergence.", categories: ["Meta-Theorems", "Ontological Engineering"] },
      { text: "What is the structure of a φ-consistent memory trace?", categories: ["Phi Dynamics", "Observer Systems"] },
      { text: "Can one truth reflect all realities simultaneously?", categories: ["Truth-Validation"] }
    ];

    const allTexts = Array.from({ length: 49 }, (_, i) => ({
      id: i + 1,
      text: `Prompt #${i + 1}: Insight for Omega layer ${i + 1}`,
      categories: [categories[i % categories.length]]
    })).concat(extraPrompts.map((p, i) => ({
      id: 50 + i,
      text: `Prompt #${50 + i}: ${p.text}`,
      categories: p.categories
    })));

    const prompts = allTexts.map(p => {
      const primary = p.categories[0];
      return {
        id: p.id,
        text: p.text,
        categories: p.categories,
        primaryCategory: primary,
        color: palette[categories.indexOf(primary)],
        phiScore: 0.042,
        oai: 0.91
      };
    });

    const container = document.getElementById('prompt-container');
    const categorySelect = document.getElementById('category-select');
    const totalCount = document.getElementById('total-count');
    const visibleCount = document.getElementById('visible-count');

    function renderPrompts(filter = 'all') {
      container.innerHTML = '';
      const filtered = prompts.filter(p => filter === 'all' || p.categories.includes(filter));

      filtered.forEach(p => {
        if (p.phiScore < 0.0303 || p.oai < 0.82) return;
        const card = document.createElement('div');
        card.className = 'prompt-card';
        card.style.background = p.color;
        card.innerHTML = `<strong>[${p.primaryCategory}]</strong><p>${p.text}</p>`;

        if (p.categories.length > 1) {
          const star = document.createElement('span');
          star.className = 'category-star';
          star.style.background = palette[categories.indexOf(p.categories[1])];
          star.textContent = '★';
          card.appendChild(star);
        }

        card.addEventListener('click', () => {
          const checksum = [...p.text].reduce((a, c) => a + c.charCodeAt(0), 0).toString(16).slice(-6);
          const full = `${p.text} [Ω-${checksum}]`;
          if (navigator.clipboard) {
            navigator.clipboard.writeText(full).then(() => {
              card.setAttribute('title', `Copied: Ω-${checksum}`);
            });
          } else {
            alert("Clipboard access denied. Copy manually:\n" + full);
          }
        });

        container.appendChild(card);
      });

      totalCount.textContent = prompts.length;
      visibleCount.textContent = filtered.filter(p => p.phiScore >= 0.0303 && p.oai >= 0.82).length;
    }

    categories.forEach(c => {
      const opt = document.createElement('option');
      opt.value = c;
      opt.textContent = c;
      categorySelect.appendChild(opt);
    });

    categorySelect.addEventListener('change', e => renderPrompts(e.target.value));

    document.getElementById('toggle-theme').addEventListener('click', () => {
      const current = document.body.getAttribute('data-theme');
      const next = current === 'dark' ? 'light' : 'dark';
      document.body.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
    });

    document.getElementById('readme-toggle').addEventListener('click', () => {
      const readme = document.getElementById('readme');
      readme.style.display = readme.style.display === 'block' ? 'none' : 'block';
    });

    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) document.body.setAttribute('data-theme', savedTheme);

    renderPrompts();
  </script>
</body>
</html>
